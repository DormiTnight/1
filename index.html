<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ ìŠ¤ë„¤ì´í¬ ê²Œì„</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        .pixel-font {
            font-family: 'Press Start 2P', cursive;
        }
        
        #gameCanvas {
            border: 4px solid #10b981;
            border-radius: 8px;
            box-shadow: 0 0 30px rgba(16, 185, 129, 0.5);
        }
        
        .snake-gradient {
            background: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%);
        }
        
        .glow {
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(16, 185, 129, 0.4); }
            to { box-shadow: 0 0 40px rgba(16, 185, 129, 0.8); }
        }
        
        .slide-up {
            animation: slideUp 0.5s ease-out;
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .rank-item {
            animation: fadeIn 0.3s ease-out forwards;
            opacity: 0;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
    </style>
</head>
<body class="bg-gray-900 min-h-screen">
    <!-- ë¡œê·¸ì¸ í™”ë©´ -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-gray-800 rounded-2xl p-8 w-full max-w-md shadow-2xl border border-emerald-500/30">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">ğŸ</div>
                <h1 class="pixel-font text-emerald-400 text-xl mb-2">SNAKE GAME</h1>
                <p class="text-gray-400 text-sm">ë¡œê·¸ì¸í•˜ê³  ìµœê³  ì ìˆ˜ì— ë„ì „í•˜ì„¸ìš”!</p>
            </div>
            
            <div id="authContainer">
                <!-- ë¡œê·¸ì¸ í¼ -->
                <div id="loginForm">
                    <div class="mb-4">
                        <label class="block text-emerald-400 text-sm mb-2">ì´ë©”ì¼</label>
                        <input type="email" id="loginEmail" 
                            class="w-full bg-gray-700 text-white rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-emerald-500"
                            placeholder="email@example.com">
                    </div>
                    <div class="mb-6">
                        <label class="block text-emerald-400 text-sm mb-2">ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" id="loginPassword" 
                            class="w-full bg-gray-700 text-white rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-emerald-500"
                            placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                    </div>
                    <button onclick="login()" 
                        class="w-full snake-gradient text-white font-bold py-3 rounded-lg hover:opacity-90 transition mb-4">
                        ë¡œê·¸ì¸
                    </button>
                    <p class="text-center text-gray-400 text-sm">
                        ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? 
                        <span onclick="showRegister()" class="text-emerald-400 cursor-pointer hover:underline">íšŒì›ê°€ì…</span>
                    </p>
                </div>
                
                <!-- íšŒì›ê°€ì… í¼ -->
                <div id="registerForm" class="hidden">
                    <div class="mb-4">
                        <label class="block text-emerald-400 text-sm mb-2">ë‹‰ë„¤ì„</label>
                        <input type="text" id="registerName" 
                            class="w-full bg-gray-700 text-white rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-emerald-500"
                            placeholder="ê²Œì„ì—ì„œ ì‚¬ìš©í•  ì´ë¦„">
                    </div>
                    <div class="mb-4">
                        <label class="block text-emerald-400 text-sm mb-2">ì´ë©”ì¼</label>
                        <input type="email" id="registerEmail" 
                            class="w-full bg-gray-700 text-white rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-emerald-500"
                            placeholder="email@example.com">
                    </div>
                    <div class="mb-6">
                        <label class="block text-emerald-400 text-sm mb-2">ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" id="registerPassword" 
                            class="w-full bg-gray-700 text-white rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-emerald-500"
                            placeholder="6ì ì´ìƒ">
                    </div>
                    <button onclick="register()" 
                        class="w-full snake-gradient text-white font-bold py-3 rounded-lg hover:opacity-90 transition mb-4">
                        íšŒì›ê°€ì…
                    </button>
                    <p class="text-center text-gray-400 text-sm">
                        ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? 
                        <span onclick="showLogin()" class="text-emerald-400 cursor-pointer hover:underline">ë¡œê·¸ì¸</span>
                    </p>
                </div>
            </div>
            
            <div id="authError" class="hidden mt-4 p-3 bg-red-500/20 border border-red-500 rounded-lg text-red-400 text-sm text-center"></div>
        </div>
    </div>
    <!-- ê²Œì„ í™”ë©´ -->
    <div id="gameScreen" class="hidden min-h-screen flex flex-col items-center justify-center p-4">
        <div class="text-center mb-6">
            <div class="flex items-center justify-between w-full max-w-lg mb-4">
                <div class="text-left">
                    <p class="text-gray-400 text-sm">í”Œë ˆì´ì–´</p>
                    <p id="playerName" class="text-emerald-400 font-bold"></p>
                </div>
                <div class="text-center">
                    <p class="text-gray-400 text-sm">ì ìˆ˜</p>
                    <p id="currentScore" class="pixel-font text-2xl text-yellow-400">0</p>
                </div>
                <div class="text-right">
                    <p class="text-gray-400 text-sm">ìµœê³  ì ìˆ˜</p>
                    <p id="highScore" class="pixel-font text-xl text-emerald-400">0</p>
                </div>
            </div>
        </div>
        
        <canvas id="gameCanvas" width="400" height="400" class="glow"></canvas>
        
        <div id="gameControls" class="mt-6 text-center">
            <button id="startBtn" onclick="startGame()" 
                class="snake-gradient text-white font-bold py-3 px-8 rounded-lg hover:opacity-90 transition pixel-font text-sm">
                ê²Œì„ ì‹œì‘
            </button>
            <p class="text-gray-500 text-sm mt-4">â¬†ï¸ â¬‡ï¸ â¬…ï¸ â¡ï¸ ë˜ëŠ” WASD í‚¤ë¡œ ì´ë™</p>
        </div>
        
        <!-- ëª¨ë°”ì¼ ì»¨íŠ¸ë¡¤ -->
        <div class="mt-6 md:hidden">
            <div class="grid grid-cols-3 gap-2 w-40 mx-auto">
                <div></div>
                <button onclick="changeDirection('up')" class="bg-gray-700 text-white p-4 rounded-lg text-2xl">â¬†ï¸</button>
                <div></div>
                <button onclick="changeDirection('left')" class="bg-gray-700 text-white p-4 rounded-lg text-2xl">â¬…ï¸</button>
                <button onclick="changeDirection('down')" class="bg-gray-700 text-white p-4 rounded-lg text-2xl">â¬‡ï¸</button>
                <button onclick="changeDirection('right')" class="bg-gray-700 text-white p-4 rounded-lg text-2xl">â¡ï¸</button>
            </div>
        </div>
        
        <button onclick="logout()" class="mt-6 text-gray-500 hover:text-gray-300 text-sm">
            ë¡œê·¸ì•„ì›ƒ
        </button>
    </div>
    <!-- ê²Œì„ ì˜¤ë²„ ëª¨ë‹¬ -->
    <div id="gameOverModal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50">
        <div class="bg-gray-800 rounded-2xl p-8 w-full max-w-md shadow-2xl border border-emerald-500/30 slide-up">
            <div class="text-center mb-6">
                <div class="text-5xl mb-4">ğŸ’€</div>
                <h2 class="pixel-font text-red-400 text-xl mb-2">GAME OVER</h2>
                <p class="text-gray-400">ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤!</p>
            </div>
            
            <div class="bg-gray-700/50 rounded-xl p-6 mb-6">
                <div class="text-center mb-4">
                    <p class="text-gray-400 text-sm">íšë“ ì ìˆ˜</p>
                    <p id="finalScore" class="pixel-font text-4xl text-yellow-400">0</p>
                </div>
                <div id="newHighScore" class="hidden text-center text-emerald-400 font-bold animate-pulse">
                    ğŸ‰ ìƒˆë¡œìš´ ìµœê³  ê¸°ë¡! ğŸ‰
                </div>
            </div>
            
            <!-- ìˆœìœ„í‘œ -->
            <div class="mb-6">
                <h3 class="text-emerald-400 font-bold mb-3 flex items-center">
                    <span class="mr-2">ğŸ†</span> ì‹¤ì‹œê°„ ìˆœìœ„
                </h3>
                <div id="leaderboard" class="bg-gray-900/50 rounded-lg p-4 max-h-60 overflow-y-auto">
                    <div class="text-gray-500 text-center">ë¡œë”© ì¤‘...</div>
                </div>
            </div>
            
            <div class="flex gap-4">
                <button onclick="restartGame()" 
                    class="flex-1 snake-gradient text-white font-bold py-3 rounded-lg hover:opacity-90 transition">
                    ë‹¤ì‹œ í•˜ê¸°
                </button>
                <button onclick="closeModal()" 
                    class="flex-1 bg-gray-700 text-white font-bold py-3 rounded-lg hover:bg-gray-600 transition">
                    ë‹«ê¸°
                </button>
            </div>
        </div>
    </div>
    <script>
        // Firebase ì„¤ì • - ì‹¤ì œ ì‚¬ìš©ì‹œ ë³¸ì¸ì˜ Firebase ì„¤ì •ìœ¼ë¡œ êµì²´í•˜ì„¸ìš”
        const firebaseConfig = {
            apiKey: "AIzaSyDemo-REPLACE-WITH-YOUR-KEY",
            authDomain: "your-project.firebaseapp.com",
            databaseURL: "https://your-project-default-rtdb.firebaseio.com",
            projectId: "your-project",
            storageBucket: "your-project.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef123456"
        };
        // Firebase ì´ˆê¸°í™”
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        // ê²Œì„ ë³€ìˆ˜
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const gridSize = 20;
        const tileCount = canvas.width / gridSize;
        
        let snake = [];
        let food = {};
        let direction = 'right';
        let nextDirection = 'right';
        let score = 0;
        let gameLoop = null;
        let gameSpeed = 100;
        let isPlaying = false;
        let currentUser = null;
        let userHighScore = 0;
        // ì¸ì¦ ìƒíƒœ í™•ì¸
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                loadUserData();
                showGameScreen();
            } else {
                currentUser = null;
                showLoginScreen();
            }
        });
        // í™”ë©´ ì „í™˜ í•¨ìˆ˜
        function showLoginScreen() {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('gameScreen').classList.add('hidden');
        }
        function showGameScreen() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            initGame();
        }
        function showLogin() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('hidden');
            hideError();
        }
        function showRegister() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
            hideError();
        }
        function showError(message) {
            const errorEl = document.getElementById('authError');
            errorEl.textContent = message;
            errorEl.classList.remove('hidden');
        }
        function hideError() {
            document.getElementById('authError').classList.add('hidden');
        }
        // ë¡œê·¸ì¸
        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showError('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            try {
                await auth.signInWithEmailAndPassword(email, password);
            } catch (error) {
                showError(getErrorMessage(error.code));
            }
        }
        // íšŒì›ê°€ì…
        async function register() {
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            
            if (!name || !email || !password) {
                showError('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            if (password.length < 6) {
                showError('ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                await userCredential.user.updateProfile({ displayName: name });
                
                // ì‚¬ìš©ì ë°ì´í„° ì €ì¥
                await database.ref('users/' + userCredential.user.uid).set({
                    name: name,
                    email: email,
                    highScore: 0,
                    createdAt: Date.now()
                });
            } catch (error) {
                showError(getErrorMessage(error.code));
            }
        }
        // ë¡œê·¸ì•„ì›ƒ
        function logout() {
            if (isPlaying) {
                endGame();
            }
            auth.signOut();
        }
        // ì—ëŸ¬ ë©”ì‹œì§€ ë³€í™˜
        function getErrorMessage(code) {
            const messages = {
                'auth/email-already-in-use': 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤.',
                'auth/invalid-email': 'ìœ íš¨í•˜ì§€ ì•Šì€ ì´ë©”ì¼ í˜•ì‹ì…ë‹ˆë‹¤.',
                'auth/user-not-found': 'ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
                'auth/wrong-password': 'ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.',
                'auth/weak-password': 'ë¹„ë°€ë²ˆí˜¸ê°€ ë„ˆë¬´ ì•½í•©ë‹ˆë‹¤.',
                'auth/invalid-credential': 'ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.'
            };
            return messages[code] || 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
        }
        // ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ
        async function loadUserData() {
            if (!currentUser) return;
            
            const displayName = currentUser.displayName || currentUser.email.split('@')[0];
            document.getElementById('playerName').textContent = displayName;
            
            try {
                const snapshot = await database.ref('users/' + currentUser.uid + '/highScore').once('value');
                userHighScore = snapshot.val() || 0;
                document.getElementById('highScore').textContent = userHighScore;
            } catch (error) {
                console.log('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }
        // ê²Œì„ ì´ˆê¸°í™”
        function initGame() {
            snake = [
                { x: 5, y: 10 },
                { x: 4, y: 10 },
                { x: 3, y: 10 }
            ];
            direction = 'right';
            nextDirection = 'right';
            score = 0;
            gameSpeed = 100;
            document.getElementById('currentScore').textContent = '0';
            generateFood();
            draw();
        }
        // ìŒì‹ ìƒì„±
        function generateFood() {
            do {
                food = {
                    x: Math.floor(Math.random() * tileCount),
                    y: Math.floor(Math.random() * tileCount)
                };
            } while (snake.some(segment => segment.x === food.x && segment.y === food.y));
        }
        // ê²Œì„ ì‹œì‘
        function startGame() {
            if (isPlaying) return;
            
            initGame();
            isPlaying = true;
            document.getElementById('startBtn').textContent = 'ê²Œì„ ì¤‘...';
            document.getElementById('startBtn').disabled = true;
            
            gameLoop = setInterval(update, gameSpeed);
        }
        // ê²Œì„ ì—…ë°ì´íŠ¸
        function update() {
            direction = nextDirection;
            
            const head = { ...snake[0] };
            
            switch (direction) {
                case 'up': head.y--; break;
                case 'down': head.y++; break;
                case 'left': head.x--; break;
                case 'right': head.x++; break;
            }
            // ë²½ ì¶©ëŒ í™•ì¸
            if (head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount) {
                endGame();
                return;
            }
            // ìê¸° ìì‹ ê³¼ ì¶©ëŒ í™•ì¸
            if (snake.some(segment => segment.x === head.x && segment.y === head.y)) {
                endGame();
                return;
            }
            snake.unshift(head);
            // ìŒì‹ ë¨¹ê¸°
            if (head.x === food.x && head.y === food.y) {
                score += 10;
                document.getElementById('currentScore').textContent = score;
                generateFood();
                
                // ì†ë„ ì¦ê°€
                if (score % 50 === 0 && gameSpeed > 50) {
                    gameSpeed -= 10;
                    clearInterval(gameLoop);
                    gameLoop = setInterval(update, gameSpeed);
                }
            } else {
                snake.pop();
            }
            draw();
        }
        // ê·¸ë¦¬ê¸°
        function draw() {
            // ë°°ê²½
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ê·¸ë¦¬ë“œ
            ctx.strokeStyle = '#2a2a4e';
            ctx.lineWidth = 0.5;
            for (let i = 0; i <= tileCount; i++) {
                ctx.beginPath();
                ctx.moveTo(i * gridSize, 0);
                ctx.lineTo(i * gridSize, canvas.height);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(0, i * gridSize);
                ctx.lineTo(canvas.width, i * gridSize);
                ctx.stroke();
            }
            // ë±€ ê·¸ë¦¬ê¸°
            snake.forEach((segment, index) => {
                const gradient = ctx.createRadialGradient(
                    segment.x * gridSize + gridSize / 2,
                    segment.y * gridSize + gridSize / 2,
                    0,
                    segment.x * gridSize + gridSize / 2,
                    segment.y * gridSize + gridSize / 2,
                    gridSize / 2
                );
                
                if (index === 0) {
                    gradient.addColorStop(0, '#34d399');
                    gradient.addColorStop(1, '#10b981');
                } else {
                    gradient.addColorStop(0, '#10b981');
                    gradient.addColorStop(1, '#059669');
                }
                
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.roundRect(
                    segment.x * gridSize + 1,
                    segment.y * gridSize + 1,
                    gridSize - 2,
                    gridSize - 2,
                    4
                );
                ctx.fill();
                
                // ëˆˆ (ë¨¸ë¦¬ì—ë§Œ)
                if (index === 0) {
                    ctx.fillStyle = 'white';
                    let eyeX1, eyeX2, eyeY1, eyeY2;
                    
                    switch (direction) {
                        case 'right':
                            eyeX1 = eyeX2 = segment.x * gridSize + 14;
                            eyeY1 = segment.y * gridSize + 6;
                            eyeY2 = segment.y * gridSize + 12;
                            break;
                        case 'left':
                            eyeX1 = eyeX2 = segment.x * gridSize + 6;
                            eyeY1 = segment.y * gridSize + 6;
                            eyeY2 = segment.y * gridSize + 12;
                            break;
                        case 'up':
                            eyeY1 = eyeY2 = segment.y * gridSize + 6;
                            eyeX1 = segment.x * gridSize + 6;
                            eyeX2 = segment.x * gridSize + 12;
                            break;
                        case 'down':
                            eyeY1 = eyeY2 = segment.y * gridSize + 14;
                            eyeX1 = segment.x * gridSize + 6;
                            eyeX2 = segment.x * gridSize + 12;
                            break;
                    }
                    
                    ctx.beginPath();
                    ctx.arc(eyeX1, eyeY1, 2, 0, Math.PI * 2);
                    ctx.arc(eyeX2, eyeY2, 2, 0, Math.PI * 2);
                    ctx.fill();
                }
            });
            // ìŒì‹ ê·¸ë¦¬ê¸°
            ctx.font = '16px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('ğŸ', food.x * gridSize + gridSize / 2, food.y * gridSize + gridSize / 2);
        }
        // ë°©í–¥ ë³€ê²½
        function changeDirection(newDirection) {
            const opposites = { up: 'down', down: 'up', left: 'right', right: 'left' };
            if (newDirection !== opposites[direction]) {
                nextDirection = newDirection;
            }
        }
        // í‚¤ë³´ë“œ ì…ë ¥
        document.addEventListener('keydown', (e) => {
            if (!isPlaying) return;
            
            const keyMap = {
                'ArrowUp': 'up', 'KeyW': 'up',
                'ArrowDown': 'down', 'KeyS': 'down',
                'ArrowLeft': 'left', 'KeyA': 'left',
                'ArrowRight': 'right', 'KeyD': 'right'
            };
            
            if (keyMap[e.code]) {
                e.preventDefault();
                changeDirection(keyMap[e.code]);
            }
        });
        // ê²Œì„ ì¢…ë£Œ
        async function endGame() {
            isPlaying = false;
            clearInterval(gameLoop);
            
            document.getElementById('startBtn').textContent = 'ê²Œì„ ì‹œì‘';
            document.getElementById('startBtn').disabled = false;
            document.getElementById('finalScore').textContent = score;
            
            // ìµœê³  ì ìˆ˜ ê°±ì‹  í™•ì¸
            const isNewHighScore = score > userHighScore;
            document.getElementById('newHighScore').classList.toggle('hidden', !isNewHighScore);
            
            if (isNewHighScore) {
                userHighScore = score;
                document.getElementById('highScore').textContent = userHighScore;
            }
            
            // ì ìˆ˜ ì €ì¥
            await saveScore();
            
            // ìˆœìœ„í‘œ ë¡œë“œ
            await loadLeaderboard();
            
            // ëª¨ë‹¬ í‘œì‹œ
            document.getElementById('gameOverModal').classList.remove('hidden');
        }
        // ì ìˆ˜ ì €ì¥
        async function saveScore() {
            if (!currentUser || score === 0) return;
            
            const displayName = currentUser.displayName || currentUser.email.split('@')[0];
            
            try {
                // ê²Œì„ ê¸°ë¡ ì €ì¥
                await database.ref('scores').push({
                    odorUserId: currentUser.uid,
                    name: displayName,
                    score: score,
                    timestamp: Date.now()
                });
                
                // ìµœê³  ì ìˆ˜ ê°±ì‹ 
                if (score >= userHighScore) {
                    await database.ref('users/' + currentUser.uid + '/highScore').set(score);
                    await database.ref('leaderboard/' + currentUser.uid).set({
                        name: displayName,
                        score: score,
                        timestamp: Date.now()
                    });
                }
            } catch (error) {
                console.log('ì ìˆ˜ ì €ì¥ ì‹¤íŒ¨:', error);
            }
        }
        // ìˆœìœ„í‘œ ë¡œë“œ
        async function loadLeaderboard() {
            const leaderboardEl = document.getElementById('leaderboard');
            leaderboardEl.innerHTML = '<div class="text-gray-500 text-center">ë¡œë”© ì¤‘...</div>';
            
            try {
                const snapshot = await database.ref('leaderboard')
                    .orderByChild('score')
                    .limitToLast(10)
                    .once('value');
                
                const scores = [];
                snapshot.forEach(child => {
                    scores.push({ id: child.key, ...child.val() });
                });
                
                scores.sort((a, b) => b.score - a.score);
                
                if (scores.length === 0) {
                    leaderboardEl.innerHTML = '<div class="text-gray-500 text-center">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                    return;
                }
                
                leaderboardEl.innerHTML = scores.map((item, index) => {
                    const isMe = currentUser && item.id === currentUser.uid;
                    const medals = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'];
                    const medal = medals[index] || `${index + 1}.`;
                    
                    return `
                        <div class="rank-item flex items-center justify-between py-2 px-3 rounded-lg mb-1 ${isMe ? 'bg-emerald-500/20 border border-emerald-500/50' : 'bg-gray-800/50'}" 
                             style="animation-delay: ${index * 0.1}s">
                            <div class="flex items-center gap-3">
                                <span class="text-lg">${medal}</span>
                                <span class="${isMe ? 'text-emerald-400 font-bold' : 'text-gray-300'}">${item.name}</span>
                            </div>
                            <span class="pixel-font text-yellow-400 text-sm">${item.score}</span>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                leaderboardEl.innerHTML = '<div class="text-gray-500 text-center">ìˆœìœ„ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
                console.log('ìˆœìœ„ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }
        // ê²Œì„ ì¬ì‹œì‘
        function restartGame() {
            closeModal();
            startGame();
        }
        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal() {
            document.getElementById('gameOverModal').classList.add('hidden');
        }
        // Enter í‚¤ë¡œ ë¡œê·¸ì¸/íšŒì›ê°€ì…
        document.getElementById('loginPassword').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') login();
        });
        
        document.getElementById('registerPassword').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') register();
        });
        // ì´ˆê¸° ê²Œì„ í™”ë©´ ê·¸ë¦¬ê¸°
        initGame();
    </script>
</body>
</html>